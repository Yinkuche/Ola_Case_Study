USE DEFAULT;

DROP TABLE IF EXISTS CDW_SAPP_D_CUSTOMER_ONE;

CREATE  EXTERNAL TABLE CDW_SAPP_D_CUSTOMER_ONE (
CUST_SSN STRING,
CUST_F_NAME STRING,
CUST_M_NAME STRING, 
CUST_L_NAME STRING, 
CUST_CC_NO STRING, 
CUST_STREET STRING, 
CUST_CITY STRING, 
CUST_STATE STRING, 
CUST_COUNTRY STRING, 
CUST_ZIP STRING, 
CUST_PHONE STRING, 
CUST_EMAIL STRING,
LAST_UPDATED timestamp) 
ROW FORMAT DELIMITED FIELDS TERMINATED BY ',' ESCAPED BY '"' LINES TERMINATED BY '\n'
LOCATION "/user/maria_dev/Credit_Card_System/CDW_SAPP_D_CUSTOMER";

DROP TABLE IF EXISTS CDW_SAPP_D_CUSTOMER;

SET hive.exec.dynamic.partition=true;
SET hive.exec.dynamic.partition.mode=nonstrict;

CREATE  EXTERNAL TABLE CDW_SAPP_D_CUSTOMER
(CUST_SSN STRING,
CUST_F_NAME STRING,
CUST_M_NAME STRING, 
CUST_L_NAME STRING, 
CUST_CC_NO STRING, 
CUST_STREET STRING, 
CUST_CITY STRING, 
CUST_STATE STRING, 
CUST_COUNTRY STRING,  
CUST_PHONE STRING, 
CUST_EMAIL STRING,
LAST_UPDATED timestamp)
PARTITIONED BY (CUST_ZIP STRING)
ROW FORMAT DELIMITED FIELDS TERMINATED BY ',' ESCAPED BY '"' LINES TERMINATED BY '\n'
LOCATION "/user/maria_dev/Credit_Card_System/CDW_SAPP_D_CUSTOMER10";

SET hive.exec.dynamic.partition=true;
SET hive.exec.dynamic.partition.mode=nonstrict;
INSERT OVERWRITE TABLE CDW_SAPP_D_CUSTOMER
PARTITION (CUST_ZIP)
SELECT CUST_SSN,
CUST_F_NAME, 
CUST_M_NAME,
CUST_L_NAME, 
CUST_CC_NO, 
CUST_STREET, 
CUST_CITY, 
CUST_STATE, 
CUST_COUNTRY, 
CUST_PHONE, 
CUST_EMAIL,
LAST_UPDATED,
CUST_ZIP

from CDW_SAPP_D_CUSTOMER_ONE;
